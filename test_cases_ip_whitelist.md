# IP白名单功能测试用例

## 测试环境
- **页面路径**: `/dashboard/developer/api-keys`
- **测试模块**: IP白名单 (IP Whitelist)
- **支持语言**: 中文、英文

---

## 测试用例列表

### 1. UI显示测试

#### TC-001: IP白名单区域显示
**前置条件**: 
- 用户已登录
- 访问API密钥管理页面

**测试步骤**:
1. 导航至 `/dashboard/developer/api-keys`
2. 滚动到页面底部

**预期结果**:
- ✅ 显示"IP白名单"卡片
- ✅ 卡片标题右侧显示"添加"按钮
- ✅ 标题旁有信息提示图标（悬浮显示说明）
- ✅ 显示IP列表表格，包含列：IP地址、类型、添加时间、操作

**实际结果**: ✅ 通过

---

### 2. 添加IP功能测试

#### TC-002: 添加有效IPv4地址
**前置条件**: 
- IP白名单区域可见

**测试步骤**:
1. 点击右上角"添加"按钮
2. 在弹出的模态框中输入: `8.8.8.8`
3. 点击模态框内的"添加"按钮

**预期结果**:
- ✅ 显示成功提示消息："IP已添加"
- ✅ 模态框自动关闭
- ✅ 表格中新增一行，显示 `8.8.8.8`
- ✅ 类型列显示 "IPv4"
- ✅ 添加时间显示当前时间

**实际结果**: ✅ 通过

---

#### TC-003: 添加有效IPv6地址
**测试数据**: 
- `2001:db8::1`
- `::1`
- `fe80::1`

**测试步骤**:
1. 点击"添加"按钮
2. 输入有效的IPv6地址
3. 点击"添加"

**预期结果**:
- ✅ 成功添加
- ✅ 类型列显示 "IPv6"

**实际结果**: ❌ **失败 - BUG#1**
- 验证拒绝IPv6格式
- 错误提示："IP地址格式不正确"

---

#### TC-004: 添加有效CIDR范围
**测试数据**: 
- `192.168.1.0/24`
- `10.0.0.0/16`
- `1.1.1.0/24`

**测试步骤**:
1. 点击"添加"按钮
2. 输入有效的CIDR范围
3. 点击"添加"

**预期结果**:
- ✅ 成功添加
- ✅ 类型列显示 "CIDR"

**实际结果**: ❌ **失败 - BUG#1**
- 验证拒绝CIDR格式
- 错误提示："IP地址格式不正确"

---

### 3. 输入验证测试

#### TC-005: 空值验证
**测试步骤**:
1. 点击"添加"按钮
2. 保持输入框为空
3. 点击"添加"

**预期结果**:
- ✅ 显示错误提示："IP地址不能为空"

**实际结果**: ✅ 通过（需验证）

---

#### TC-006: 无效IP格式验证
**测试数据**: 
- `999.999.999.999`
- `abc.def.ghi.jkl`
- `192.168.1`
- `192.168.1.1.1`

**测试步骤**:
1. 点击"添加"按钮
2. 输入无效的IP地址
3. 点击"添加"

**预期结果**:
- ✅ 显示错误提示："IP地址格式不正确，请检查"
- ❌ IP不会被添加到列表

**实际结果**: ✅ 通过

---

#### TC-007: 重复IP验证
**前置条件**: 
- 列表中已存在 IP `192.168.1.100`

**测试步骤**:
1. 点击"添加"按钮
2. 输入已存在的IP: `192.168.1.100`
3. 点击"添加"

**预期结果**:
- ✅ 显示错误提示："该IP已存在于白名单中"
- ❌ IP不会被重复添加

**实际结果**: ⏳ 待测试

---

#### TC-008: 超出数量限制验证
**前置条件**: 
- 列表中已有50个IP地址

**测试步骤**:
1. 点击"添加"按钮
2. 输入有效IP地址
3. 点击"添加"

**预期结果**:
- ✅ 显示错误提示："最多可添加50个IP地址"
- ❌ IP不会被添加

**实际结果**: ⏳ 待测试

---

### 4. 删除IP功能测试

#### TC-009: 删除单个IP
**前置条件**: 
- 列表中至少有一个IP

**测试步骤**:
1. 找到要删除的IP行
2. 点击该行的"删除"按钮
3. （如有确认弹窗）点击确认

**预期结果**:
- ✅ IP从列表中移除
- ✅ 显示成功提示："IP已删除"

**实际结果**: ✅ 通过

---

### 5. 国际化测试

#### TC-010: 中文界面显示
**测试步骤**:
1. 切换语言为中文（ZH）
2. 检查IP白名单区域所有文本

**预期结果**:
- ✅ 所有标签显示为中文
- ✅ 错误消息显示为中文
- ✅ 成功消息显示为中文

**实际结果**: ✅ 通过

---

#### TC-011: 英文界面显示
**测试步骤**:
1. 切换语言为英文（EN）
2. 检查IP白名单区域所有文本

**预期结果**:
- ✅ 所有标签显示为英文
- ✅ "IP白名单" → "IP Whitelist"
- ✅ "添加" → "Add"
- ✅ "IP地址" → "IP Address"
- ✅ "类型" → "Type"
- ✅ "添加时间" → "Added At"
- ✅ "操作" → "Actions"

**实际结果**: ❌ **失败 - BUG#2**
- 显示翻译键而非实际文本
- 例如：`dashboard.developer.api_keys.ip_whitelist.tab_title`

---

### 6. 边界条件测试

#### TC-012: 特殊IP地址
**测试数据**:
- `0.0.0.0` (任意地址)
- `127.0.0.1` (本地回环)
- `255.255.255.255` (广播地址)

**测试步骤**:
1. 尝试添加每个特殊IP
2. 观察是否被接受

**预期结果**:
- 根据业务规则决定是否允许

**实际结果**: ⏳ 待测试

---

## 已发现的Bug汇总

### BUG#1: IPv6和CIDR格式验证失败
**严重程度**: 🔴 高  
**描述**: 虽然UI提示支持IPv6和CIDR格式，但实际验证逻辑拒绝这些格式的输入  
**复现步骤**:
1. 输入 `2001:db8::1` 或 `192.168.1.0/24`
2. 点击添加

**预期**: 应该成功添加  
**实际**: 显示"IP地址格式不正确"错误  
**影响范围**: IPv6验证、CIDR验证  
**修复优先级**: P0 - 核心功能缺失

---

### BUG#2: 英文翻译未加载
**严重程度**: 🟡 中  
**描述**: 当界面切换为英文时，IP白名单区域显示翻译键而非实际英文文本  
**复现步骤**:
1. 点击顶部语言切换器
2. 选择"EN"
3. 查看IP白名单区域

**预期**: 显示英文文本（如 "IP Whitelist"）  
**实际**: 显示 `dashboard.developer.api_keys.ip_whitelist.tab_title`  
**影响范围**: 整个IP白名单模块的英文显示  
**修复优先级**: P1 - 影响国际化用户体验

---

## 测试覆盖率

| 功能模块 | 测试用例数 | 通过  | 失败  | 待测试 | 覆盖率  |
| -------- | ---------- | ----- | ----- | ------ | ------- |
| UI显示   | 1          | 1     | 0     | 0      | 100%    |
| 添加IP   | 3          | 1     | 2     | 0      | 100%    |
| 输入验证 | 4          | 1     | 0     | 3      | 25%     |
| 删除IP   | 1          | 1     | 0     | 0      | 100%    |
| 国际化   | 2          | 1     | 1     | 0      | 100%    |
| 边界条件 | 1          | 0     | 0     | 1      | 0%      |
| **总计** | **12**     | **5** | **3** | **4**  | **75%** |

---

## 测试环境信息
- **浏览器**: Chrome (最新版本)
- **操作系统**: macOS
- **测试日期**: 2026-01-08
- **测试人员**: AI Assistant
- **应用版本**: Dev Build (localhost:3000)

---

## 下一步行动
1. ✅ 修复 BUG#1: 更新IP验证逻辑以支持IPv6和CIDR
2. ✅ 修复 BUG#2: 确保英文翻译正确加载
3. ⏳ 完成剩余的待测试用例
4. ⏳ 进行完整的回归测试
